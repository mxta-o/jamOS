{% extends "base.html" %}

{% block title %}Habit Tracker - jamSpace{% endblock %}

{% block extra_css %}
<style>
.habit-grid {
    display: grid;
    gap: 1.5rem;
}

.habit-item {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border-radius: 15px;
    padding: 1.5rem;
    border: 1px solid rgba(255, 255, 255, 0.2);
    transition: all 0.3s ease;
}

.habit-item:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-2px);
}

.habit-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.habit-name {
    font-size: 1.2rem;
    font-weight: 600;
    color: rgba(176, 196, 222);
}

.habit-streak {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.7);
}

.habit-progress {
    display: flex;
    gap: 0.3rem;
    margin: 1rem 0;
}

.day-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    transition: all 0.3s ease;
}

.day-dot.completed {
    background: rgba(76, 175, 80, 0.8);
}

.day-dot.today {
    border: 2px solid rgba(176, 196, 222, 0.8);
}

.habit-actions {
    display: flex;
    gap: 0.5rem;
}

.btn-small {
    padding: 0.5rem 1rem;
    font-size: 0.8rem;
}

.add-habit-form {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 2rem;
    border: 1px solid rgba(255, 255, 255, 0.2);
    margin-bottom: 2rem;
}

.form-row {
    display: flex;
    gap: 1rem;
    align-items: end;
}
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1 class="page-title">habit tracker</h1>
        <p class="page-subtitle">
            build consistency, track progress, celebrate wins âœ¨
        </p>
    </div>

    <div class="add-habit-form">
        <h3 class="card-title">Add New Habit</h3>
        <form action="{{ url_for('productivity.habit_tracker') }}" method="POST">
            <div class="form-row">
                <div class="form-group" style="flex: 1;">
                    <label class="form-label">Habit Name</label>
                    <input type="text" name="habit_name" class="form-input" placeholder="e.g., Drink 8 glasses of water" required>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Add Habit</button>
                </div>
            </div>
        </form>
    </div>

    <div class="habit-grid">
        {% for habit in habits %}
        <div class="habit-item">
            <div class="habit-header">
                <span class="habit-name">{{ habit.name }}</span>
                <span class="habit-streak">{{ habit.current_streak }} day streak ðŸ”¥</span>
            </div>
            
            <div class="habit-progress">
                {% for i in range(30) %}
                <div class="day-dot {% if i in habit.completed_days %}completed{% endif %} {% if i == habit.today_index %}today{% endif %}"></div>
                {% endfor %}
            </div>
            
            <div class="habit-actions">
                <button class="btn btn-primary btn-small" onclick="markCompleted('{{ habit.id }}')">
                    âœ“ Done Today
                </button>
                <button class="btn btn-danger btn-small" onclick="deleteHabit('{{ habit.id }}')">
                    Delete
                </button>
            </div>
        </div>
        {% else %}
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">No habits yet!</h3>
                <p class="card-subtitle">Add your first habit above to start building consistency</p>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function markCompleted(habitId) {
    fetch('/apps/habit-tracker/complete', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({habit_id: habitId})
    }).then(() => {
        location.reload();
    });
}

function deleteHabit(habitId) {
    if (confirm('Are you sure you want to delete this habit?')) {
        fetch('/apps/habit-tracker/delete', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({habit_id: habitId})
        }).then(() => {
            location.reload();
        });
    }
}
</script>
{% endblock %}
